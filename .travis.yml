## .travis.yml secure parameters set in the travis admin panel
# - SLACK_API_TOKEN
# - GOOGLE_CAPTCHA_SECRET
# - GOOGLE_CAPTCHA_SITEKEY
# - DEPLOY_AWS_ACCESS_KEY_ID
# - DEPLOY_AWS_SECRET_ACCESS_KEY

language: node_js
node_js:
  - stable

before_deploy: 
  - curl -L https://github.com/a8m/envsubst/releases/download/v1.0.0/envsubst-`uname -s`-`uname -m` -o envsubst
  - chmod +x envsubst
  - ./envsubst -no-unset -no-empty < .env.example > .env
  - zip -q -r dt2018-slackin.zip . --exclude node_modules\* .elasticbeanstalk\* .git\*

deploy:
  provider: elasticbeanstalk
  access_key_id: ${DEPLOY_AWS_ACCESS_KEY_ID}
  secret_access_key: ${DEPLOY_AWS_SECRET_ACCESS_KEY}
  region: "eu-west-1"
  app: "dt2018"
  env: "gh-dt2018-slackin"
  bucket_name: "dt2018-slackin"

  skip_cleanup: true
  zip_file: dt2018-slackin

  on:
    branch: master

after_deploy:
  - rm dt2018-slackin
  - rm .env
